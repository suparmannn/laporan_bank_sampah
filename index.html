<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Green - Laporan </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .mobile-view { width: 100%; max-width: 480px; min-height: 100vh; margin: 0 auto; background: white; position: relative; }
        .hidden { display: none; }
        .report-card { transition: all 0.2s ease; border: 1px solid #f1f5f9; }
        .report-card:active { transform: scale(0.98); background-color: #f8fafc; }
        
        /* Simulasi Export Preview */
        .preview-modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.9); z-index: 100; padding: 15px; display: none; overflow-y: auto; }
        .preview-content { background: white; width: 100%; max-width: 1000px; margin: 0 auto; padding: 30px; border-radius: 8px; font-size: 11px; color: #334155; }
        .preview-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
       .preview-table th { background: #f8fafc; border: 1px solid #e2e8f0; padding: 10px; text-align: left; font-weight: 800; text-transform: uppercase; font-size: 10px; }
        .preview-table td { border: 1px solid #e2e8f0; padding: 10px; vertical-align: middle; }
        .excel-header { background: #15803d !important; color: white !important; }
        .excel-header th { background: #15803d !important; color: white !important; }
    </style>
</head>
<body>

<div class="mobile-view shadow-2xl">

    <div id="screen-dashboard" class="animate-in fade-in duration-300">
        <div class="p-6 bg-slate-900 text-white rounded-b-[40px] mb-8 shadow-lg">
            <div class="flex justify-between items-center mb-10">
                <span class="font-extrabold tracking-tighter text-xl italic text-emerald-400">GoGreen.</span>
                <span class="text-[9px] bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 px-3 py-1 rounded-full font-bold uppercase">Unit A - Aktif</span>
            </div>
            <p class="text-slate-400 text-[10px] uppercase font-bold tracking-[2px]">Total Saldo Operasional</p>
            <h2 class="text-3xl font-extrabold mb-2 tracking-tight">Rp 25.450.000</h2>
            <div class="h-1 w-12 bg-emerald-500 rounded-full"></div>
        </div>

        <div class="px-6">
            <div onclick="showScreen('screen-report')" class="bg-white p-5 rounded-[28px] border border-slate-100 shadow-sm flex items-center gap-4 cursor-pointer active:bg-slate-50 transition-all">
                <div class="w-14 h-14 bg-emerald-50 rounded-2xl flex items-center justify-center text-2xl shadow-inner">üìä</div>
                <div class="flex-1">
                    <h3 class="font-bold text-slate-800 text-sm">Laporan Transaksi</h3>
                    <p class="text-[10px] text-slate-400 font-medium">Monitoring Sampah & Kas</p>
                </div>
                <div class="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-300">‚Üí</div>
            </div>

            <div onclick="showScreen('screen-admin-fee')" class="bg-white p-5 rounded-[28px] border border-slate-100 shadow-sm flex items-center gap-4 cursor-pointer active:bg-slate-50 transition-all mt-4">
    <div class="w-14 h-14 bg-amber-50 rounded-2xl flex items-center justify-center text-2xl shadow-inner">‚öôÔ∏è</div>
    <div class="flex-1">
        <h3 class="font-bold text-slate-800 text-sm">Master Biaya Admin</h3>
        <p class="text-[10px] text-slate-400 font-medium">Setting % Potongan Global</p>
    </div>
    <div class="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-300">‚Üí</div>
</div>
        </div>
    </div>

    <div id="screen-report" class="hidden">
        <div class="p-5 flex items-center border-b bg-white sticky top-0 z-10">
            <button onclick="showScreen('screen-dashboard')" class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-50 text-slate-800 font-bold mr-3">‚Üê</button>
            <h1 class="font-extrabold text-slate-900 text-sm uppercase tracking-tight">Laporan Transaksi</h1>
        </div>

        <div class="p-6 bg-white border-b space-y-5">
            <div class="grid grid-cols-2 gap-4">
                <div class="space-y-1.5">
                    <label class="text-[9px] font-black text-slate-400 uppercase ml-1">Dari Tanggal</label>
                    <input type="date" id="f-start" class="w-full p-3 bg-slate-50 border-none rounded-2xl text-xs font-bold focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
                <div class="space-y-1.5">
                    <label class="text-[9px] font-black text-slate-400 uppercase ml-1">Sampai Tanggal</label>
                    <input type="date" id="f-end" class="w-full p-3 bg-slate-50 border-none rounded-2xl text-xs font-bold focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
            </div>

            <div class="space-y-1.5">
                <label class="text-[9px] font-black text-slate-400 uppercase ml-1">Filter Arus Transaksi</label>
                <select id="f-category" onchange="renderReport()" class="w-full p-4 bg-slate-50 border-none rounded-2xl text-xs font-bold outline-none appearance-none cursor-pointer">
                    <option value="ALL">Semua Aktivitas</option>
                    <option value="SAMPAH_IN">üì¶ Sampah Masuk (Nasabah)</option>
                    <option value="SAMPAH_OUT">üöõ Sampah Keluar (Pengepul)</option>
                    <option value="FIN_IN">üí∞ Kas Masuk (Penjualan)</option>
                    <option value="FIN_OUT">üí∏ Kas Keluar (Settlement)</option>
                </select>
            </div>


            <div class="flex gap-3 pt-2">
                <button onclick="exportView('Excel')" class="flex-1 bg-emerald-600 text-white py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-lg shadow-emerald-200">üìó Download Excel</button>
                <button onclick="exportView('PDF')" class="flex-1 bg-rose-600 text-white py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-lg shadow-rose-200">üìï Download PDF</button>
            </div>
        </div>

        <div class="p-6 space-y-4" id="report-list">
            </div>
    </div>

    <div id="preview-modal" class="preview-modal">
        <div class="flex justify-between items-center max-w-[1000px] mx-auto mb-4">
            <p class="text-white text-[10px] font-bold uppercase tracking-widest">Preview Mode</p>
            <button onclick="closePreview()" class="bg-rose-500 text-white px-6 py-2 rounded-full font-bold text-[10px] uppercase">Tutup Preview</button>
        </div>
        <div class="preview-content shadow-2xl overflow-x-auto" id="preview-area">
            </div>
    </div>

    <div id="screen-admin-fee" class="hidden">
    <div class="p-5 flex items-center border-b bg-white sticky top-0 z-10">
        <button onclick="showScreen('screen-dashboard')" class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-50 text-slate-800 font-bold mr-3">‚Üê</button>
        <h1 class="font-extrabold text-slate-900 text-sm uppercase tracking-tight">Master Biaya Admin</h1>
    </div>

    <div class="p-8 space-y-6">
        <div class="bg-amber-50 p-4 rounded-2xl border border-amber-100">
            <p class="text-[11px] text-amber-800 leading-relaxed font-medium">
                <strong>Info:</strong> Persentase di sini akan menjadi nilai default untuk setiap setoran sampah baru.
            </p>
        </div>

       <div class="space-y-2">
    <label class="text-[10px] font-black text-slate-400 uppercase ml-1">Default Biaya Admin (%)</label>
    <div class="relative">
        <input type="number" id="input-admin-fee" value="5.00" step="0.01" disabled
            class="w-full p-4 bg-slate-100 border-none rounded-2xl text-lg font-bold text-slate-400 outline-none transition-all" />
        <span class="absolute right-5 top-1/2 -translate-y-1/2 font-bold text-slate-400">%</span>
    </div>
</div>

<div id="action-area" class="pt-2">
    <button id="btn-edit-mode" onclick="toggleEditMode(true)" class="w-full bg-emerald-600 text-white py-4 rounded-2xl text-[11px] font-black uppercase tracking-widest shadow-lg">
        Ubah Data
    </button>

    <div id="edit-actions" class="hidden grid grid-cols-2 gap-3">
        <button onclick="toggleEditMode(false)" class="py-4 bg-slate-100 text-slate-500 rounded-2xl text-[11px] font-black uppercase">
            Batal
        </button>
        <button onclick="saveAdminFee()" class="py-4 bg-slate-900 text-white rounded-2xl text-[11px] font-black uppercase shadow-lg">
            Simpan
        </button>
    </div>
</div>

        <div class="pt-4 border-t border-dashed border-slate-200">
            <p class="text-[9px] text-slate-400 italic">
                * Perubahan ini tidak akan mengubah biaya admin pada transaksi yang sudah berstatus 'Success' sebelumnya.
            </p>
        </div>
    </div>
</div>

</div>

<script>
    // Master Data Dummy - SEKARANG LEBIH RAPI
    // item = KHUSUS Kategori Sampah
    // desc = Keterangan Tambahan (Penerimaan/Pembayaran)
    const dataTransaksi = [
    { date: '2026-02-20', cat: 'SAMPAH_IN', entity: 'Siti Nur Aulia', item: 'Plastik PET', desc: 'Drop-off Nasabah', refId: 'BSU-A-2026-02-20-001', qty: 12.5, val: 0, bank: 'Unit A' },
    { date: '2026-02-20', cat: 'FIN_OUT', entity: 'Siti Nur Aulia', item: 'Plastik PET', desc: 'Settlement Pembayaran', refId: 'SET-20260220-0001', qty: 0, val: 37500, bank: 'Unit A' },
    { date: '2026-02-21', cat: 'SAMPAH_OUT', entity: 'PT Pengepul Jaya', item: 'Plastik HDPE', desc: 'Pickup Pengepul', refId: 'RP/BSU-A/2026/02/0004', qty: 100.0, val: 0, bank: 'Unit A' },
    { date: '2026-02-21', cat: 'FIN_IN', entity: 'PT Pengepul Jaya', item: 'Plastik HDPE', desc: 'Penerimaan Hasil Jual', refId: 'RP/BSU-A/2026/02/0004', qty: 0, val: 450000, bank: 'Unit A' },
    { date: '2026-02-22', cat: 'SAMPAH_IN', entity: 'Budi Setiawan', item: 'Plastik Biji', desc: 'Drop-off Nasabah', refId: 'BSU-A-2026-02-22-001', qty: 5.2, val: 0, bank: 'Unit A' },
    { date: '2026-02-22', cat: 'SAMPAH_IN', entity: 'Gustiana', item: 'Plastik Emberan', desc: 'Drop-off Nasabah', refId: 'BSU-A-2026-02-22-002', qty: 15.0, val: 0, bank: 'Unit A' },
    { date: '2026-02-23', cat: 'SAMPAH_OUT', entity: 'Lapak Berkah Recycle', item: 'Plastik PEP', desc: 'Pickup Pengepul', refId: 'RP/BSU-A/2026/02/0005', qty: 80.0, val: 0, bank: 'Unit A' },
];

   // Update fungsi showScreen agar mengenali screen baru
function showScreen(id) {
    document.getElementById('screen-dashboard').classList.add('hidden');
    document.getElementById('screen-report').classList.add('hidden');
    // Tambahkan baris ini jika kamu menambah screen lain secara manual
    const adminScreen = document.getElementById('screen-admin-fee');
    if(adminScreen) adminScreen.classList.add('hidden');

    const target = document.getElementById(id);
    target.classList.remove('hidden');
    
    if(id === 'screen-report') renderReport();
}

// Fungsi Simpan (Simulasi API call)
function saveAdminFee() {
    const feeValue = document.getElementById('input-admin-fee').value;
    
    if(feeValue === "" || feeValue < 0) {
        alert("Masukkan nilai persentase yang valid!");
        return;
    }

    // Simulasi integrasi ke profile_bank_sampah
    console.log(`Syncing default_admin_fee_percentage: ${feeValue}% to profile_bank_sampah`);
    
    alert(`Berhasil! Biaya admin default diset ke ${feeValue}%. Nilai ini akan otomatis sync ke tabel waste_deposits untuk transaksi mendatang.`);
    
    showScreen('screen-dashboard');
}

    function getLabel(cat) {
        const labels = {
            'SAMPAH_IN': { text: 'Masuk', color: 'text-emerald-600 bg-emerald-50', icon: 'üì¶' },
            'SAMPAH_OUT': { text: 'Keluar', color: 'text-rose-600 bg-rose-50', icon: 'üöõ' },
            'FIN_IN': { text: 'Kas In', color: 'text-blue-600 bg-blue-50', icon: 'üí∞' },
            'FIN_OUT': { text: 'Kas Out', color: 'text-orange-600 bg-orange-50', icon: 'üí∏' }
        };
        return labels[cat];
    }

    // Fungsi untuk buka/tutup proteksi input
function toggleEditMode(isEditing) {
    const input = document.getElementById('input-admin-fee');
    const btnEdit = document.getElementById('btn-edit-mode');
    const editActions = document.getElementById('edit-actions');

    if (isEditing) {
        // Mode Edit Aktif
        input.disabled = false;
        input.classList.remove('bg-slate-100', 'text-slate-400');
        input.classList.add('bg-white', 'text-slate-900', 'ring-2', 'ring-emerald-500');
        input.focus();
        
        btnEdit.classList.add('hidden');
        editActions.classList.remove('hidden');
    } else {
        // Kembali ke Mode Read-Only (Lock)
        input.disabled = true;
        input.classList.add('bg-slate-100', 'text-slate-400');
        input.classList.remove('bg-white', 'text-slate-900', 'ring-2', 'ring-emerald-500');
        
        btnEdit.classList.remove('hidden');
        editActions.classList.add('hidden');
    }
}

// Update fungsi simpan agar otomatis mengunci kembali setelah sukses
function saveAdminFee() {
    const feeValue = document.getElementById('input-admin-fee').value;
    
    if(feeValue === "" || feeValue < 0) {
        alert("Masukkan nilai yang valid!");
        return;
    }

    // Logic sinkronisasi ke DB profile_bank_sampah di sini...
    console.log("Simpan default_admin_fee_percentage:", feeValue);
    
    alert(`Konfigurasi Berhasil Disimpan: ${feeValue}%`);
    
    // Lock kembali field setelah simpan
    toggleEditMode(false);
    showScreen('screen-dashboard');
}

    function renderReport() {
        const filter = document.getElementById('f-category').value;
        const container = document.getElementById('report-list');
        container.innerHTML = '';

        const filtered = dataTransaksi.filter(t => filter === 'ALL' || t.cat === filter);

        filtered.forEach(t => {
            const meta = getLabel(t.cat);
            const isFin = t.cat.startsWith('FIN');
            
            const card = `
                <div class="report-card p-5 bg-white rounded-[24px] shadow-sm space-y-3">
                    <div class="flex justify-between items-start">
                        <div class="flex gap-2 items-center">
                            <span class="${meta.color} text-[8px] font-black px-2 py-1 rounded-lg uppercase tracking-wider">${meta.text}</span>
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-tight">${t.date}</p>
                        </div>
                        <span class="text-sm grayscale opacity-50">${meta.icon}</span>
                    </div>
                    <div class="flex justify-between items-end">
                        <div class="space-y-0.5">
                            <p class="text-[11px] font-extrabold text-slate-800">${t.entity}</p>
                            
                                <div class="flex items-center gap-1.5">
                                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
                                    <p class="text-[10px] text-emerald-700 font-bold">${t.item}</p>
                                    <span class="text-[9px] text-slate-400 ml-1 italic font-medium">[${t.refId}]</span>
                                </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-black ${isFin ? 'text-blue-700' : 'text-slate-900'}">
                                ${isFin ? 'Rp ' + t.val.toLocaleString('id-ID') : t.qty + ' Kg'}
                            </p>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += card;
        });
    }

    function exportView(type) {
        const modal = document.getElementById('preview-modal');
        const area = document.getElementById('preview-area');
        modal.style.display = 'block';

        const isExcel = type === 'Excel';
        const headerClass = isExcel ? 'excel-header' : '';
        
        let rows = '';
        dataTransaksi.forEach((t, i) => {
           
                rows += `
                    <tr>
                        <td style="text-align:center">${i+1}</td>
                        <td>${t.date}</td>
                        <td style="font-weight:bold">${getLabel(t.cat).text.toUpperCase()}</td>
                        <td>${t.entity}</td>
                        <td style="color:#059669; font-weight:bold">${t.item}</td>
                        <td>
                            <div style="font-weight:bold">${t.desc}</div>
                            <div style="font-size:9px; color:#64748b">${t.refId}</div>
                        </td>
                        <td style="text-align:right; font-weight:bold">${t.qty > 0 ? t.qty + ' Kg' : '-'}</td>
                        <td style="text-align:right; font-weight:bold; color:#1d4ed8">${t.val > 0 ? 'Rp ' + t.val.toLocaleString('id-ID') : '-'}</td>
                    </tr>
                `;
        });

        // Ganti bagian area.innerHTML di dalam fungsi exportView(type) dengan ini:
area.innerHTML = `
    <div style="padding:10px; border-left: 5px solid ${isExcel ? '#15803d' : '#e11d48'}; margin-bottom:20px">
        <h1 style="margin:0; font-size: 18px; font-weight:800; color:#1e293b">BANK SAMPAH UNIT A</h1>
        <p style="margin:2px 0; color:#64748b; font-weight:700">LAPORAN TRANSAKSI</p>
        <div style="display:flex; gap:20px; margin-top:10px; font-size:9px; color:#94a3b8; font-weight:bold">
            <span>WAKTU CETAK: ${new Date().toLocaleString('id-ID', { dateStyle: 'long', timeStyle: 'short' })}</span>
            <span>FORMAT: ${type.toUpperCase()}</span>
            <span>BANK SAMPAH: BANK SAMPAH UNIT A</span>
        </div>
    </div>
    <table class="preview-table">
        <thead>
            <tr class="${headerClass}">
                <th style="width:30px">No</th>
                <th>Tanggal</th>
                <th>Tipe</th>
                <th>Nasabah / Pengepul</th>
                <th>Kategori Sampah</th>
                <th>Keterangan</th>
                <th style="text-align:right">Qty</th>
                <th style="text-align:right">Nilai (Rp)</th>
            </tr>
        </thead>
        <tbody>
            ${rows}
        </tbody>
    </table>
    <div style="margin-top:40px; display:flex; justify-content: space-between; align-items:flex-end">
        <div style="font-size:8px; color:#94a3b8">
            * Dokumen ini dihasilkan secara otomatis oleh Sistem GoGreen.<br>
            * Dicetak pada: ${new Date().toLocaleString('id-ID')}
        </div>
        <div style="text-align:center; min-width:150px">
            <p style="margin-bottom:50px">Manager Unit A</p>
            <p style="font-weight:bold; border-top:1px solid #334155; padding-top:5px">( M.Suparman )</p>
        </div>
    </div>
`;
    }

    function closePreview() {
        document.getElementById('preview-modal').style.display = 'none';
    }

    // Initialize Default Dates
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('f-start').value = today;
    document.getElementById('f-end').value = today;
</script>
</body>

</html>



